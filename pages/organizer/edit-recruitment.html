<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Create Vendor Recruitment Post</title>
        <link rel="stylesheet" href="../../assets/css/bootstrap.css" />
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
        <link rel="stylesheet" href="../../assets/css/style.css">
        <link rel="stylesheet"
            href="../../assets/lib/bootstrap-icon/bootstrap-icons.css">
        <link rel="stylesheet" href="../../assets/css/organizer.css">
        <link rel="stylesheet" href="../../assets/css/lim_style.css">
        <!-- quillJS -->
        <link rel="stylesheet" href="../../assets/lib/QuilJs/quill.snow.css">

    </head>

    <body>
        <header class="border" id="header">
            <div class="container">
                <nav class="d-flex align-items-center justify-content-between">
                    <div class="logo">
                        <a href="../homepage.html">
                            <img
                                src="../../assets/img/logo/Prutika_Logo_text(2).png"
                                alt>
                        </a>
                    </div>
                    <div
                        class="d-flex align-items-center w-25 position-relative ">
                        <i
                            class="fa-solid fa-magnifying-glass text-brand fs-6 position-absolute"></i>
                        <input type="text"
                            class="form-control search-bar ps-5 w-100 " name
                            id="searchEvent"
                            aria-describedby="helpId"
                            placeholder="Search Event " />
                        <button class="btn-pink text-white"><i
                                class="fa-solid fa-magnifying-glass text-brand fs-6"></i></button>
                        <ul class="search-dropdown position-absolute"
                            id="search-dropdown">

                        </ul>
                    </div>
                    <div class="action-btn d-flex">
                        <button class="btn-outline-pink ms-3"><i
                                class="fa-solid fa-plus text-brand"></i> <a
                                href="../../pages/organizer/create-events.html">Create
                                a
                                post</a> </button>
                        <a href="#" class=" btn-outline-pink ms-3" role="button"
                            id="browseDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Browse <i
                                class="fa-solid fa-caret-down text-brand"></i>
                            <!-- User Icon -->
                        </a>
                        <a href="../ticket/myticket.html"
                            class="btn-outline-pink ms-3 d-flex align-items-center"><i
                                class="fa-solid fa-ticket pe-1 text-brand"></i>My
                            Ticket</a>

                        <ul class="dropdown-menu dropdown-menu-end"
                            aria-labelledby="browseDropdown">
                            <li><a class="dropdown-item"
                                    href="../browse/browse-event.html">Browse
                                    events</a></li>
                            <li><a class="dropdown-item"
                                    href="../browse/browse-recruitment.html">Browse
                                    vendor recruitments</a></li>
                            <li><a class="dropdown-item"
                                    href="../browse/browse-vendor.html">Browse
                                    vendor services</a></li>

                        </ul>
                    </div>
                    <div class="dropdown">
                        <a href="#"
                            class="dropdown-toggle fs-3 text-brand d-flex align-items-center"
                            role="button"
                            id="accountDropdown" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bi bi-person-circle"></i>
                            <!-- User Icon -->
                            <span class="ps-1 fs-6" id="userEmail"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end"
                            aria-labelledby="accountDropdown">
                            <li><a class="dropdown-item"
                                    href="../organizer/event.html">Manage
                                    as
                                    organizer</a></li>
                            <li><a class="dropdown-item"
                                    href="../vendor/vendor-business.html">Manage
                                    as
                                    vendor</a></li>
                            <li><a class="dropdown-item"
                                    href="../browse/wishlist.html">Wishlist</a></li>
                            <li><a class="dropdown-item"
                                    href="../authentication/accountsetting.html">Account
                                    Setting</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item"
                                    href="javascript:void(0);"
                                    id="btn-logout">Log
                                    out</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
        <main>
            <div class="d-flex">
                <nav class="shadow sidebar">
                    <ul>
                        <li><a href="event.html" class="active"><i
                                    class="fas fa-menorah"></i><span
                                    class="nav-item">Event</span></a></li>
                        <li><a href="request-ticket.html"><i
                                    class="fa-solid fa-ticket"></i><span
                                    class="nav-item">Request
                                    Ticket</span></a></li>
                        <li><a href="check-in-ticket.html"><i
                                    class="fa-solid fa-qrcode"></i><span
                                    class="nav-item">Check-in
                                    Ticket</span></a></li>
                        <li><a href="group-collaborate.html"><i
                                    class="fa-solid fa-user-group"></i><span
                                    class="nav-item">Event Group
                                    Collaborated</span></a></li>
                        <li><a href="profile.html"><i
                                    class="fa-solid fa-user"></i><span
                                    class="nav-item">Organizer
                                    Profile</span></a></li>
                    </ul>
                </nav>

                <section class="w-100">
                    <div class="p-4">
                        <div class="container-fluid">
                            <button type="button"
                                class="btn border-0 ps-0 d-flex align-items-center mb-5"
                                onclick="history.back()">
                                <i
                                    class="fa-solid fa-angle-left fs-6 m-0 p-0"></i>
                                <span class="m-0 ps-2">Back to Vendor</span>
                            </button>

                            <form action class="px-5" id="vendorForm">
                                <h2 class="mb-5 ps-2">Update Vendor Recruitment
                                    Post</h2>

                                <div
                                    class="sub-form-wrapper p-4 border rounded-4 mt-4">
                                    <div class="form-display d-none">
                                        <div class="title">
                                            <h1 class="fw-bold">Post Title</h1>
                                            <p>Give an attractive brief
                                                paragraph about your
                                                recruitment.</p>
                                        </div>
                                        <img class="icon-img"
                                            src="../../assets/lim_img/icon/plus.png"
                                            alt>
                                    </div>
                                    <div class="main-form active">
                                        <h4 class="fw-bold pb-3">Vendor
                                            Recruitment Post Overview</h4>
                                        <h5>Post Title*</h5>
                                        <div class="form-floating mb-5">
                                            <input type="text"
                                                class="form-control customized-form"
                                                id="postTitle" placeholder>
                                            <label for="postTitle">Your post
                                                title <span
                                                    class="text-danger">*</span></label>
                                        </div>

                                        <div
                                            class="category-select d-flex mb-5">
                                            <div class="w-25 me-5">
                                                <h5>Vendor Categories*</h5>
                                                <select
                                                    class="form-select customized-form"
                                                    aria-label="Default select example"
                                                    multiple
                                                    id="categorySelect">
                                                    <!-- Categories will be populated dynamically -->
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="sub-form-wrapper p-4 border rounded-4 mt-4">
                                    <div class="form-display">
                                        <div class="title">
                                            <h1 class="fw-bold">Add full
                                                description</h1>
                                        </div>
                                        <img class="icon-img"
                                            src="../../assets/lim_img/icon/plus.png"
                                            alt>
                                    </div>
                                    <div class="main-form">
                                        <h4
                                            class="fw-bold pb-3">Description</h4>
                                        <h5>Add full description about your
                                            need</h5>
                                        <div class="description mt-3 mb-5">
                                            <div id="editor"></div>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="sub-form-wrapper p-4 border rounded-4 mt-4">
                                    <div class="form-display">
                                        <div class="title">
                                            <h1 class="fw-bold">Event Date and
                                                Location</h1>
                                        </div>
                                        <img class="icon-img"
                                            src="../../assets/lim_img/icon/plus.png"
                                            alt>
                                    </div>
                                    <div class="main-form">
                                        <h4 class="fw-bold pb-3">Date and
                                            Location</h4>
                                        <h5>Date and time*</h5>
                                        <div class="datetime d-flex">
                                            <div
                                                class="form-floating mb-3 w-25 me-5">
                                                <input type="date"
                                                    class="form-control customized-form"
                                                    id="startDate" placeholder>
                                                <label for="startDate">Start
                                                    Date</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="time"
                                                    class="form-control customized-form"
                                                    id="startTime" placeholder>
                                                <label for="startTime">Start
                                                    Time</label>
                                            </div>
                                        </div>
                                        <div class="datetime d-flex mb-3">
                                            <div
                                                class="form-floating mb-3 w-25 me-5">
                                                <input type="date"
                                                    class="form-control customized-form"
                                                    id="endDate" placeholder>
                                                <label for="endDate">End
                                                    Date</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="time"
                                                    class="form-control customized-form"
                                                    id="endTime" placeholder>
                                                <label for="endTime">End
                                                    Time</label>
                                            </div>
                                        </div>
                                        <h5>Location*</h5>
                                        <div
                                            class="location-info d-flex flex-wrap">
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="text"
                                                    class="form-control customized-form"
                                                    id="address1" placeholder>
                                                <label for="address1">Address
                                                    1</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="text"
                                                    class="form-control customized-form"
                                                    id="address2" placeholder>
                                                <label for="address2">Address
                                                    2</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="text"
                                                    class="form-control customized-form"
                                                    id="city" placeholder>
                                                <label for="city">City</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <input type="text"
                                                    class="form-control customized-form"
                                                    id="province" placeholder>
                                                <label
                                                    for="province">State/Province</label>
                                            </div>
                                            <div
                                                class="form-floating mb-3 me-5">
                                                <select id="country"
                                                    name="country"
                                                    class="form-control customized-form">
                                                    <option
                                                        value="Cambodia">Cambodia</option>
                                                </select>
                                                <label
                                                    for="country">Country</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end my-5">
                                    <button class="btn-pink" type="button"
                                        onclick="updateRecruit()">Update</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        <script src="../../assets/js/ultilities.js"></script>
        <script src="../../assets/js/authentication.js"></script>
        <script src="../../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../../assets/js/form_collapse.js"></script>
        <script src="../../assets/lib/QuilJs/quill.js"></script>
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            window.descQuill = new Quill('#editor', { theme: 'snow' });
        });
    </script>
        <script>
            let editId = sessionStorage.getItem('editRecruitId')
    // Fetching and populating the form with vendor recruitment data
    fetch(`${API_URL}/api/vendors/${editId}`)
        .then(response => response.json())
        .then(data => {
            const vendorData = data.data;
    
            // Set the form fields with the data
            document.getElementById('postTitle').value = vendorData.name;
            document.getElementById('startDate').value = vendorData.start_date.split(' ')[0];
            document.getElementById('startTime').value = vendorData.start_date.split(' ')[1];
            document.getElementById('endDate').value = vendorData.end_date.split(' ')[0];
            document.getElementById('endTime').value = vendorData.end_date.split(' ')[1];
            document.getElementById('address1').value = vendorData.location.split(',')[0];
            document.getElementById('address2').value = vendorData.location.split(',')[1] || '';
            document.getElementById('city').value = vendorData.location.split(',')[2] || ''
            document.getElementById('province').value = vendorData.location.split(',')[3] || '';
            descQuill.root.innerHTML = vendorData.description;

            // Fetch vendor categories and populate category select
            fetch(`${API_URL}/api/vendor-categories`, {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            })
            .then(res => res.json())
            .then(json => {
                const { data: categories } = json;
    let eventCatSelect = document.getElementById('categorySelect');

    // Clear any existing options
    eventCatSelect.innerHTML = '';

    // Populate category select options
    categories.forEach(category => {
        let opt = document.createElement('option');
        opt.value = category.id;
        opt.innerHTML = category.name;
        eventCatSelect.appendChild(opt);
    });

    // Set the category select to the vendor's categories if available
    if (vendorData.categories && vendorData.categories.length > 0) {
        vendorData.categories.forEach(category => {
            const selectedOption = eventCatSelect.querySelector(`option[value="${category.id}"]`);
            if (selectedOption) {
                selectedOption.setAttribute('selected', '');
            }
        });
    }
            })
            .catch(error => console.error('Error fetching vendor categories:', error));

        })
        .catch(error => console.error('Error fetching vendor data:', error));
    
    // Function to handle the update form submission
    function updateRecruit() {

        let categoriesSelect = document.getElementById('categorySelect');
    let categoriesList = []
    for (let catOption of categoriesSelect.options) {
        if (catOption.selected) {
            categoriesList.push(catOption.value);
        }
    }

        const updatedData = {
            name: document.getElementById('postTitle').value,
            start_date: document.getElementById('startDate').value + ' ' + document.getElementById('startTime').value,
            end_date: document.getElementById('endDate').value + ' ' + document.getElementById('endTime').value,
            location: `${document.getElementById('address1').value}, ${document.getElementById('address2').value} , ${document.getElementById('city').value}, ${document.getElementById('province').value}, ${document.getElementById('country').value}`,
            description: descQuill.root.innerHTML,
            vendor_category_ids: JSON.stringify(categoriesList)
        };
    
        fetch(`${API_URL}/api/vendors/${editId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                Authorization: 'Bearer ' + token
            },
            body: JSON.stringify(updatedData),
        })
        .then(response => response.json())
        .then(data => {
            if(data.result == true){

                showToast('Vendor Recruitment post updated successfully', true);
                setTimeout(()=>{
                    location.href = "recruitment.html";
                }, 1500);
            }
            else{
                showToast('Failed to update vendor Recruitment post', false);
            }
        })
        .catch(error => {
            console.error('Error updating vendor post:', error);
            alert('Failed to update vendor post');
        });
    }
</script>

    </body>

</html>