<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruttika | Update Business</title>
    <link rel="stylesheet" href="../../assets/css/bootstrap.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/lib/bootstrap-icon/bootstrap-icons.css">
    <link rel="stylesheet" href="../../assets/css/organizer.css">
    <link rel="stylesheet" href="../../assets/css/lim_style.css">
    <!-- quillJS -->
    <link rel="stylesheet" href="../../assets/lib/QuilJs/quill.snow.css">
    <link rel="icon" type="image/jpg" href="../../assets/img/logo/Pruttikar_Logo2.png">

</head>

<body>
    <header class="border px-1" id="header">
        <div class="container-fluid px-4">
            <nav class="d-flex align-items-center justify-content-between">
                <div class="logo">
                    <a href="../homepage.html">
                        <img src="../../assets/img/logo/Prutika_Logo_text(2).png" alt>
                    </a>
                </div>

                <div class="dropdown">
                    <a href="#" class="dropdown-toggle fs-3 text-brand d-flex align-items-center" role="button"
                        id="accountDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                        <!-- User Icon -->
                        <span class="ps-1 fs-6" id="userEmail"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                        <li><a class="dropdown-item" href="../homepage.html">Switch to Attending</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
    <main>
        <div class>
            <div class="d-flex">
                <nav class="shadow sidebar">
                    <ul>
                        <li>
                            <a href="vendor-business.html" class="active">
                                <i class="fas fa-menorah"></i>
                                <span class="nav-item">Vendor Business</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <section class="w-100 ">
                    <!-- <div class="step-side py-4">
                        <div class="d-flex align-items-center ">
                            
                        </div>
                    </div> -->
                    <div class="p-4">
                        <div class="container-fluid">
                            <button type="button" class="btn border-0 ps-0 d-flex align-items-center mb-5"
                                onclick="history.back()">
                                <i class="fa-solid fa-angle-left fs-6 m-0 p-0 "></i>
                                <span class="m-0 ps-2">Back to Vendor</span>
                            </button>
                            <form action="" class="px-5">
                                <h2 class="mb-5 ps-2">Update a vendor business post</h2>
                                <div class="form-display d-none">
                                    <div class="title">
                                        <h1 class="fw-bold">Add a photo as your thumbnail</h1>
                                    </div>
                                    <img class="icon-img" src="../../assets/lim_img/icon/plus.png" alt="..">
                                </div>
                                <div class="sub-form-wrapper active p-4 border rounded-4 mt-4 ">
                                    <div class="main-form active upload-img-form">
                                        <h4 class="fw-bold pb-3">Add your image</h4>
                                        <div class="d-flex align-items-center mb-3">
                                            <img class="tip-icon" src="../../assets/lim_img/icon/bulb.png" alt="">
                                            <p class="p-0 m-0"><span class="fw-bold">Tip:</span> Use photo that attracts
                                                viewers.</p>
                                        </div>
                                        <div
                                            class="upload-section d-flex align-items-center justify-content-center p-5 flex-column">
                                            <i id="imgIcon" class="fa-regular fa-image fs-1 text-secondary pb-3"></i>
                                            <label id="imgInputBtn" for="fileUpload" class="btn-outline-pink"><i
                                                    class="fa-regular fa-image fs-5 text-secondary"></i> Upload
                                                Image</label>
                                            <input class="d-none" id="fileUpload" type="file"></input>
                                            <div class="d-flex">
                                                <p id="fileName" class="text-secondary pt-3">No file chosen</p>
                                                <button id="btnRemoveImgFile"
                                                    class="ms-1 text-secondary fw-bold">X</button>
                                            </div>
                                            <img id="imageDisplay" src="" alt="img preview">

                                        </div>
                                        <div class="img-format pt-3 w-100">
                                            <ul type="circle" class="d-flex justify-content-evenly">
                                                <li>Recommended image size: 2160 x 1080px</li>
                                                <li>Maximum file size: 10MB</li>
                                                <li>Supported image files: .JPEG, .PNG</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="sub-form-wrapper p-4 border rounded-4 mt-4 ">
                                    <div class="form-display">
                                        <div class="title">
                                            <h1 class="fw-bold">Business Post Title</h1>
                                            <p>Give an attractive brief paragraph about your business.</p>
                                        </div>
                                        <img class="icon-img" src="../../assets/lim_img/icon/plus.png" alt="">
                                    </div>
                                    <div class="main-form">
                                        <h4 class="fw-bold pb-3">Business Post Overview</h4>
                                        <h5>Business Post Title*</h5>
                                        <div class="form-floating mb-5">
                                            <input type="text" class="form-control customized-form" id="postTitle"
                                                placeholder="">
                                            <label for="floatingInput">Your post title <span
                                                    class="text-danger">*</span></label>
                                            <div id="lblPostTitle"></div>
                                        </div>

                                        <div class="category-select d-flex mb-5">
                                            <div class="w-25 me-5">
                                                <h5>Business Categories*</h5>
                                                <select class="form-select customized-form"
                                                    aria-label="Default select example" multiple id="categorySelect">
                                                    <!-- <option selected>Select a category</option>
                                                    <option value="1">One</option>
                                                    <option value="2">Two</option>
                                                    <option value="3">Three</option> -->
                                                </select>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="sub-form-wrapper p-4 border rounded-4 mt-4 ">
                                    <div class="form-display">
                                        <div class="title">
                                            <h1 class="fw-bold">Add full description</h1>
                                        </div>
                                        <img class="icon-img" src="../../assets/lim_img/icon/plus.png" alt="">
                                    </div>
                                    <div class="main-form">
                                        <h4 class="fw-bold pb-3">Description</h4>
                                        <h5>Add full description about your business</h5>
                                        <div class="description mt-3 mb-5">
                                            <div id="editor" class="bg-white"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sub-form-wrapper p-4 border rounded-4 mt-4 ">
                                    <div class="form-display">
                                        <div class="title">
                                            <h1 class="fw-bold">Add Contact Information</h1>
                                        </div>
                                        <img class="icon-img" src="../../assets/lim_img/icon/plus.png" alt="">
                                    </div>
                                    <div class="main-form">
                                        <h4 class="fw-bold pb-3">Contact and Location</h4>
                                        <h5>Add your business contact information*</h5>
                                        <div class="form-floating mb-3">
                                            <input type="email" class="form-control customized-form" id="email"
                                                placeholder="">
                                            <label for="floatingInput">Email </label>
                                            <div id="lblEmail"></div>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control customized-form" id="phone"
                                                placeholder="">
                                            <label for="floatingInput">Phone Number </label>
                                            <div id="lblPhone"></div>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control customized-form" id="facebook"
                                                placeholder="">
                                            <label for="floatingInput"><i class="fa-brands fa-facebook"></i> Facebok
                                            </label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control customized-form" id="telegram"
                                                placeholder="">
                                            <label for="floatingInput"><i class="fa-brands fa-telegram"></i> Telegram
                                            </label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control customized-form" id="tiktok"
                                                placeholder="">
                                            <label for="floatingInput"><i class="fa-brands fa-tiktok"></i> Tiktok
                                            </label>
                                        </div>
                                        <div class="form-floating mb-5">
                                            <input type="text" class="form-control customized-form" id="linkedin"
                                                placeholder="">
                                            <label for="floatingInput"><i class="fa-brands fa-linkedin"></i> Linkedin
                                            </label>
                                        </div>
                                        <h5>Location*</h5>
                                        <div class="location-info d-flex flex-wrap">
                                            <div class="form-floating mb-3 me-5">
                                                <input type="text" class="form-control customized-form" id="address1"
                                                    placeholder="">
                                                <label for="floatingInput">Address 1 </label>
                                            </div>
                                            <div class="form-floating mb-3 me-5">
                                                <input type="text" class="form-control customized-form" id="address2"
                                                    placeholder="">
                                                <label for="floatingInput">Address 2 </label>
                                            </div>
                                            <div class="form-floating mb-3 me-5">
                                                <input type="text" class="form-control customized-form" id="city"
                                                    placeholder="">
                                                <label for="floatingInput">District </label>
                                            </div>
                                            <div class="form-floating mb-3 me-5">
                                                <input type="text" class="form-control customized-form" id="province"
                                                    placeholder="">
                                                <label for="floatingInput">City/Province </label>
                                            </div>
                                            <div class="form-floating mb-3 me-5">
                                                <input type="text" class="form-control customized-form" id="country"
                                                    placeholder="">
                                                <label for="floatingInput">Country</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end my-5">
                                    <button id="btn-update-bu" class="btn btn-pink" type="button" onclick="updateBusiness()">Update</button>
                                </div>
                            </form>
                        </div>
                    </div>

                </section>
            </div>
        </div>
    </main>
    <script src="../../assets/js/ultilities.js"></script>
    <script src="../../assets/js/authentication.js"></script>
    <script src="../../assets/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="../../assets/js/header.js"></script> -->
    <script src="../../assets/js/form_collapse.js"></script>
    <script src="../../assets/lib/QuilJs/quill.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            window.descQuill = new Quill('#editor', { theme: 'snow' });
        });
    </script>
    <script src="../../assets/js/organizer/create_vendor_business.js"></script>
    <script>
        // Upload File in create event
        let fileInput = document.getElementById('fileUpload');
        let fileNameDisplay = document.getElementById('fileName');
        let btnRemoveImgFile = document.getElementById('btnRemoveImgFile');
        let imageDisplay = document.getElementById('imageDisplay');

        // Update the file name display when a file is selected
        fileInput.addEventListener('change', function () {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;

                let reader = new FileReader();
                reader.onload = function (event) {
                    imageDisplay.src = event.target.result; // Set the image source
                    imageDisplay.style.display = 'block';   // Display the image
                }
                reader.readAsDataURL(fileInput.files[0]); // Read the file as a data URL

            }
            document.getElementById('imgInputBtn').style.display = 'none';
            document.getElementById('imgIcon').style.display = 'none';
            btnRemoveImgFile.style.display = 'block';
        });

        function removeImageFile() {
            fileInput.value = ''; // Clear the file input
            fileNameDisplay.textContent = 'No file chosen';
        }
        btnRemoveImgFile.addEventListener('click', function () {
            fileInput.value = '';
            imageDisplay.src = '';
            imageDisplay.style.display = 'none';
            fileNameDisplay.textContent = 'No file chosen';
            btnRemoveImgFile.style.display = 'none';
            document.getElementById('imgInputBtn').style.display = 'block';
            document.getElementById('imgIcon').style.display = 'block';
        });
    </script>
    <script src="../../assets/js/form_validation.js"></script>
    <script>

        let editId = sessionStorage.getItem('editBusinessid')


        fetch(`${API_URL}/api/businesses?pages=1&per_page=10000`)
            .then(res => res.json())
            .then(json => {


                let businesses = json.data.filter(ele => ele.id == editId)[0];
                // Populate form fields
                document.getElementById('postTitle').value = businesses.name || '';

                const categorySelect = document.getElementById('categorySelect');
                businesses.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.text = category.name;
                    option.setAttribute('selected', '')
                    categorySelect.add(option);
                });


                descQuill.root.innerHTML = businesses.description || '';

                document.getElementById('email').value = businesses.email || '';
                document.getElementById('phone').value = businesses.phone || '';
                document.getElementById('facebook').value = businesses.facebook || '';
                document.getElementById('telegram').value = businesses.telegram || '';
                document.getElementById('tiktok').value = businesses.tiktok || '';
                document.getElementById('linkedin').value = businesses.linkedin || '';
                const str = businesses.location;

// Split the string into an array of values by using `split` with the comma and space as the delimiter
const parts = str.split(", ");

// Assign each part to a separate variable
const [address1, address2, city, province, country] = parts;
                
                document.getElementById('address1').value = address1 || '';
                document.getElementById('address2').value = address2 || '';
                document.getElementById('city').value = city || '';
                document.getElementById('province').value = province || '';
                document.getElementById('country').value = country || '';
                document.getElementById("imageDisplay").src = businesses.thumbnail
                document.getElementById("imageDisplay").style.display = 'block'


            })

        function updateBusiness() {
            // Create Vendor Business form variables
            let thumbnailFile = document.getElementById('fileUpload').files[0];
            // let descPhoto = document.getElementById('photoUpload').files[0];
            // let servicePrice = document.getElementById('servicePrice').value;
            let businessName = document.getElementById('postTitle').value;
            let email = document.getElementById('email').value;
            let phone = document.getElementById('phone').value;
            let facebook = document.getElementById('facebook').value;
            let telegram = document.getElementById('telegram').value;
            let tiktok = document.getElementById('tiktok').value;
            let linkedin = document.getElementById('linkedin').value;
            let address1 = document.getElementById('address1').value;
            let address2 = document.getElementById('address2').value;
            let city = document.getElementById('city').value;
            let province = document.getElementById('province').value;
            let country = document.getElementById('country').value;
            let fullAddress = `${address1}, ${address2}, ${city}, ${province}, ${country}`;

            let categoriesSelect = document.getElementById('categorySelect');

            let categoriesList = []
            for (let catOption of categoriesSelect.options) {
                if (catOption.selected) {
                    categoriesList.push(catOption.value);
                }
            }

            //get text from Qill form

            let descQuillContent = descQuill.root.innerHTML;  // or use quill.getText() for plain text



            let description = descQuillContent;

            

            let eventData = new FormData();
            if (thumbnailFile) {
                eventData.append('thumbnail', thumbnailFile);
            }
            eventData.append('name', businessName);
            eventData.append('location', fullAddress);
            eventData.append('description', descQuill.root.innerHTML);
            eventData.append('phone', phone);
            eventData.append('email', email);
            eventData.append('facebook', facebook);
            eventData.append('linkedin', linkedin);
            eventData.append('telegram', telegram);
            eventData.append('tiktok', tiktok);
            eventData.append('business_category_ids', JSON.stringify(categoriesList));

            if (isValid_vendorBusiness() == true) {
                    document.getElementById('btn-update-bu').disabled = true
    document.body.style.cursor = 'wait'
                fetch(`${API_URL}/api/businesses/${editId}`, {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${token}`,
                        "Accept": "application/json",
                    },
                    body: eventData
                    // JSON.stringify(eventData)
                    // JSON.stringify({
                    //     name: businessName,
                    //     location: fullAddress,
                    //     description: description,
                    //     phone: phone,
                    //     email: email,
                    //     facebook: facebook,
                    //     linkedin: linkedin,
                    //     telegram: telegram,
                    //     tiktok: tiktok,
                    //     business_category_ids: JSON.stringify(categoriesList),
                    // })
                })
                    .then(res => res.json())
                    .then(json => {
                            document.getElementById('btn-update-bu').disabled = false
    document.body.style.cursor = 'default'
                        
                        showToast(json.result == true ?  "Updated Business Successfully.":json.message, json.result)
                        if (json.result == true) {
                            setTimeout(() => {
                                location.href = "vendor-business.html";
                            }, 1500);
                        }
                    })
            }

        }

    </script>

</body>

</html>